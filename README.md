# PileupTools

This repository contains tools for doing various pileup studies. In general the individual scripts should have some documentation built in so you can run with the `-h` flag to see the expected arguments, options, etc.

At the moment it contains:

### Tools for 2017-18 UL scenarios

* `splitJSON.py`: Takes a certification JSON and divides it into smaller chunks, so they can be run in parallel.

* `processMultiFiles.py`: Takes the scripts produced by `splitJSON.py` and invokes brilcalc to produce the per-bunch luminosity for each. NOTE: This uses a default bunch threshold of 0.2 (i.e., any bunches with a luminosity less than 0.2 of the maximum individual bunch luminosity will be discarded), which may need to be changed for unusual running conditions.

* `makePileupHisto.py`: Takes the brilcalc output files produced by `processMultiFiles.py` and generates the final histogram containing the bunch-by-bunch pileup distribution.

* `makeBXPlot.py`: A script to illustrate the difference between the true bunch-by-bunch distribution of luminosity and the Gaussian approximation used in `pileupCalc.py`.

* `plotStandardDifference.py`: Plots the difference between the pileup scenario generated by `makePileupHisto.py`, using the true bunch-by-bunch distribution, with the pileup distribution generated by `pileupCalc.py`.

* `plotShifts.py`: Plots the difference between the pileup scenario generated with the nominal inelastic cross section with the systematically shifted scenarios.

The `Results2017UL/` and `Results2018UL/` contain the results for the generation of the 2017 and 2018 UL scenarios and some more specific documentation on the details of the process.

### Tools for older pileup scenarios

* `smearPileupSummer2018.py`: This takes the 2018 pileup scenario using the extrapolation from the current (as of June 2018) data from Andrea and applies a smearing to get a final distribution.

* `make2018PileupScenario.py`: A script for making the preliminary 2018 pileup scenario. This takes the 2017 data and "un-levels" it in order to get an estimation of the 2018 pileup.

### Other tools

* `averagePileup.py`: A very simple script that will take a CSV output file from brilcalc and compute the luminosity-weighted average pileup in that file.

* `make_cfi_file.py`: Takes a histogram of the pileup distribution, as produced by `makePileupHisto.py` or `pileupCalc.py`, and generates the corresponding cfi file that can be used in CMSSW for MC generation.

* `select_low_pileup.py`: This script takes an input JSON, selects only lumisections with a pileup below a specified threshold (5.0 by default), and writes out the resulting list of lumisections.

* `smearPileupPoisson.py`: This script shows the difference between the "true" and "observed" pileup distributions by applying a Poisson smearing to the former.

Please see the scripts themselves for further documentation.

